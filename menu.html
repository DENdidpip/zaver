<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tangram - Výber úrovne</title>
  
  <!-- PWA Meta Tags -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3498db">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Tangram">
  
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    #statsPanel {
      background: #f5f5f5;
      padding: 15px;
      margin: 20px 0;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .level-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .level-card {
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 8px;
      text-decoration: none;
      color: black;
      display: block;
    }

    #statsPanel {
      margin-bottom: 30px;
      padding: 20px;
      background-color: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #dee2e6;
    }

    #statsPanel h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #495057;
      text-align: center;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      text-align: center;
    }

    .stat-item {
      padding: 10px;
      background-color: white;
      border-radius: 6px;
      border: 1px solid #e9ecef;
    }

    .stat-item strong {
      font-size: 1.2em;
      color: #007bff;
    }

    .completion-status {
      margin-top: 8px;
      font-weight: bold;
    }

    .completed {
      color: #28a745;
    }

    .not-completed {
      color: #dc3545;
    }
  </style>
</head>
<body>

<a href="#" onclick="history.back()">Späť</a>

<div>
  <h1>Tangram - Výber úrovne</h1>
  
  <!-- Общая статистика -->
  <div id="statsPanel">
    <!-- Статистика будет добавлена динамически -->
  </div>
  
  <div class="level-grid" id="levelGrid">
    <!-- Уровни будут добавлены динамически -->
  </div>
</div>

<script>
// Данные уровней
const levelData = [
  {
    id: 1,
    name: "Štvorec",
    description: "Jednoduchá forma",
    difficulty: "Ľahké"
  },
  {
    id: 2, 
    name: "Trojuholník",
    description: "Klasická forma", 
    difficulty: "Stredné"
  },
  {
    id: 3,
    name: "Lichobežník", 
    description: "Zložitá forma",
    difficulty: "Ťažké"
  }
];

// Загрузка лучших времен из localStorage
function getBestTime(levelId) {
  const bestTimes = JSON.parse(localStorage.getItem('tangramBestTimes') || '{}');
  const time = bestTimes[`level_${levelId}`];
  return time ? formatTime(time) : '--:--';
}

// Загрузка количества попыток для уровня
function getAttemptCount(levelId) {
  const attempts = JSON.parse(localStorage.getItem('tangramAttempts') || '{}');
  return attempts[`level_${levelId}`] || 0;
}

// Проверка, пройден ли уровень
function isLevelCompleted(levelId) {
  const completed = JSON.parse(localStorage.getItem('tangramCompleted') || '{}');
  return completed[`level_${levelId}`] || false;
}

// Подсчет общих статистик
function getTotalStats() {
  const completed = JSON.parse(localStorage.getItem('tangramCompleted') || '{}');
  const attempts = JSON.parse(localStorage.getItem('tangramAttempts') || '{}');
  
  const completedCount = Object.values(completed).filter(Boolean).length;
  const totalAttempts = Object.values(attempts).reduce((sum, count) => sum + count, 0);
  
  return { completedCount, totalAttempts, totalLevels: levelData.length };
}

// Форматирование времени
function formatTime(seconds) {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

// Создание карточек уровней
function createLevelCards() {
  const grid = document.getElementById('levelGrid');
  
  levelData.forEach(level => {
    const card = document.createElement('a');
    card.className = 'level-card';
    card.href = `index.html?level=${level.id}`;
    
    const bestTime = getBestTime(level.id);
    const attempts = getAttemptCount(level.id);
    const completed = isLevelCompleted(level.id);
    
    card.innerHTML = `
      <div>Úroveň ${level.id}: ${level.name} ${completed ? '✓' : ''}</div>
      <div>${level.description}</div>
      <div>
        <span>${level.difficulty}</span>
        <span>Čas: ${bestTime}</span>
      </div>
      <div>
        <span>Pokusov: ${attempts}</span>
        <span>Stav: ${completed ? 'Dokončené' : 'Nedokončené'}</span>
      </div>
    `;
    
    grid.appendChild(card);
  });
}

// Создание панели статистики
function createStatsPanel() {
  const statsPanel = document.getElementById('statsPanel');
  const stats = getTotalStats();
  
  statsPanel.innerHTML = `
    <h3>Celková štatistika</h3>
    <div class="stats-grid">
      <div class="stat-item">
        <strong>${stats.completedCount}</strong><br>
        Dokončených úrovní
      </div>
      <div class="stat-item">
        <strong>${stats.totalLevels - stats.completedCount}</strong><br>
        Zostáva dokončiť
      </div>
      <div class="stat-item">
        <strong>${stats.totalAttempts}</strong><br>
        Celkovo pokusov
      </div>
      <div class="stat-item">
        <strong>${stats.completedCount > 0 ? Math.round((stats.completedCount / stats.totalLevels) * 100) : 0}%</strong><br>
        Percento dokončenia
      </div>
    </div>
  `;
}

// Инициализация страницы
document.addEventListener('DOMContentLoaded', function() {
  createStatsPanel();
  createLevelCards();
});

// Регистрация Service Worker для PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js')
      .then(registration => {
        console.log('SW зарегистрирован успешно:', registration.scope);
      })
      .catch(error => {
        console.log('SW регистрация не удалась:', error);
      });
  });
}
</script>

</body>
</html>